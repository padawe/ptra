<!DOCTYPE html>
<html>
<head>
  <title>Practice Tracker (Firebase Seed)</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #1a1a1a;
      --card-color: #fafafa;
      --button-bg: #d6d6d6;
      --button-text: #1a1a1a;
      --add-button-bg: #3399ff;
    }

    body.dark {
      --bg-color: #1c1c1c;
      --text-color: #e6e6e6;
      --card-color: #2a2a2a;
      --button-bg: #333333;
      --button-text: #e6e6e6;
      --add-button-bg: #3399ff;
    }

    body {
      margin: 20px;
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }

    #date {
      text-align: center;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    h1 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-transform: uppercase;
      margin-bottom: 20px;
    }

    button {
      background-color: var(--button-bg);
      color: var(--button-text);
      border: none;
      padding: 5px 8px;
      border-radius: 4px;
      text-transform: uppercase;
      cursor: pointer;
      font-weight: bold;
      margin-left: 5px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .li-left {
      display: flex;
      align-items: center;
    }

    .li-left button {
      margin-left: 5px;
    }

    #add-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--add-button-bg);
      color: white;
      border-radius: 4px;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="date">September 17, 2025</div>
  <h1>
    Practices
    <button id="mode-toggle">M</button>
  </h1>
  <ul id="list"></ul>
  <button id="add-btn">+</button>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // --- Firebase configuration ---
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project-default-rtdb.firebaseio.com",
      projectId: "your-project",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const userPath = 'users/defaultUser/practices'; // single user for now

    // --- Default practices ---
    const defaultPractices = [
      { id: 1, name: "Meditate", completed: false },
      { id: 2, name: "Run", completed: false },
      { id: 3, name: "Cook", completed: false },
      { id: 4, name: "Journal", completed: false },
      { id: 5, name: "Learn", completed: false }
    ];

    let practices = [];

    // --- Render function ---
    function render() {
      const list = document.getElementById("list");
      list.innerHTML = "";

      practices.forEach((p, index) => {
        const li = document.createElement("li");

        const leftDiv = document.createElement("div");
        leftDiv.className = "li-left";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = p.completed;
        checkbox.onchange = () => {
          practices[index].completed = checkbox.checked;
          save();
        };

        const nameSpan = document.createElement("span");
        nameSpan.textContent = " " + p.name;

        // Edit button
        const editBtn = document.createElement("button");
        editBtn.textContent = "E";
        editBtn.onclick = () => {
          const newName = prompt("Rename practice:", p.name);
          if (newName && newName.trim() !== "") {
            practices[index].name = newName.trim();
            save();
            render();
          }
        };

        leftDiv.appendChild(checkbox);
        leftDiv.appendChild(nameSpan);
        leftDiv.appendChild(editBtn);

        // Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "D";
        deleteBtn.onclick = () => {
          if (confirm(`Delete "${p.name}"?`)) {
            practices.splice(index, 1);
            save();
            render();
          }
        };

        li.appendChild(leftDiv);
        li.appendChild(deleteBtn);
        list.appendChild(li);
      });
    }

    // --- Save to Firebase ---
    function save() {
      const dataToSave = {};
      practices.forEach(p => dataToSave[p.id] = p);
      db.ref(userPath).set(dataToSave);
    }

    // --- Load from Firebase ---
    function load() {
      db.ref(userPath).once('value').then(snapshot => {
        const saved = snapshot.val() || {};
        practices = Object.values(saved);

        // Merge defaults
        defaultPractices.forEach(def => {
          if (!practices.find(p => p.id === def.id)) {
            practices.push(def);
          }
        });
        render();
      });
    }

    // --- Light/Dark mode toggle ---
    document.getElementById("mode-toggle").onclick = () => {
      document.body.classList.toggle("dark");
    };

    // --- Add new practice ---
    document.getElementById("add-btn").onclick = () => {
      const name = prompt("Enter new practice name:");
      if (name && name.trim() !== "") {
        const newId = practices.length > 0 ? Math.max(...practices.map(p => p.id)) + 1 : 1;
        practices.push({ id: newId, name: name.trim(), completed: false });
        save();
        render();
      }
    };

    load();
  </script>
</body>
</html>
