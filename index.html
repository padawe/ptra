<!DOCTYPE html>
<html>
<head>
  <title>Practice Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin:0;
      padding:0;
      background:#ddd; /* main background */
      color:#111;
      transition: background 0.3s, color 0.3s;
      display:flex;
      justify-content:center;
    }
    body.dark {
      background:#111;
      color:#f5f5f5;
    }

    #app-container {
      width:100%;
      max-width:450px;
      min-height:100vh;  /* full viewport height */
      padding:20px;
      background:#eee; /* secondary background */
      border-radius:8px;
      box-sizing:border-box;
      transition: background 0.3s;
    }
    body.dark #app-container {
      background:#222; /* dark mode secondary background */
    }

    /* --- Top date row --- */
    #top-row {
      display:flex;
      justify-content:center;
      align-items:center;
      margin-bottom:16px;
      gap:8px;
    }

    #date-picker {
      font-size:16px;
      padding:4px 8px;
      border:2px solid transparent;
      border-radius:4px;
      outline:none;
      cursor:pointer;
      transition:border-color 0.3s, color 0.3s;
      background:inherit;
      color:inherit;
    }

    /* Highlight current date in blue */
    #date-picker.current {
      border-color:#007bff; 
      color:#007bff;
    }
    body.dark #date-picker.current {
      border-color:#66b2ff;
      color:#66b2ff;
    }

    /* Buttons */
    button {
      border:none;
      outline:none;
      border-radius:4px;
      width:32px;
      height:32px;
      font-weight:bold;
      text-transform:uppercase;
      cursor:pointer;
      background:#e0e0e0;
      transition: background 0.3s, color 0.3s;
    }
    body.dark button { background:#444; color:#f5f5f5; }
    #add-btn { width:48px; height:48px; font-size:24px; background:#007bff; color:white; }

    /* Heading row */
    #heading-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    h1 { margin:0; text-transform:uppercase; font-size:20px; }

    /* List & cards */
    ul { list-style:none; padding:0; margin:0; }
    li {
      background:#f9f9f9;
      margin:8px 0;
      padding:8px;
      border-radius:8px;
      display:flex;
      align-items:center;
      cursor:pointer;
      transition: background 0.3s;
      width:100%;
    }
    body.dark li { background:#333; }

    li input[type="checkbox"] { margin-right:12px; }
    .edit-btn { margin-left:10px; background:#f0f0f0; color:#333; }
    body.dark .edit-btn { background:#555; color:#ddd; }
    .delete-btn { margin-left:auto; background:#f0f0f0; color:#333; }
    body.dark .delete-btn { background:#555; color:#ddd; }

    #add-btn {
      position:fixed;
      bottom:20px;
      right:calc(50% - 225px + 20px);
    }
  </style>
</head>
<body>

  <div id="app-container">

    <div id="top-row">
      <button id="prev-day">&lt;</button>
      <input type="date" id="date-picker">
      <button id="next-day">&gt;</button>
    </div>

    <div id="heading-row">
      <h1>PRACTICES</h1>
      <button id="mode-btn">M</button>
    </div>

    <ul id="list"></ul>
    <button id="add-btn">+</button>

  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDIdTwkFuX6YicW5SuXAC8EDuxdDFlRDFc",
      authDomain: "practicetracker-4c679.firebaseapp.com",
      databaseURL: "https://practicetracker-4c679-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "practicetracker-4c679",
      storageBucket: "practicetracker-4c679.firebasestorage.app",
      messagingSenderId: "919695284161",
      appId: "1:919695284161:web:a5dad6756da4745c3b8140"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentDate = new Date().toISOString().split("T")[0];
    const datePicker = document.getElementById("date-picker");
    const listEl = document.getElementById("list");
    const bodyEl = document.body;
    datePicker.value = currentDate;

    const defaultPractices = [
      { id:1, name:"Meditate", completed:false },
      { id:2, name:"Run", completed:false },
      { id:3, name:"Cook", completed:false },
      { id:4, name:"Journal", completed:false },
      { id:5, name:"Learn", completed:false }
    ];

    function highlightCurrentDate() {
      const today = new Date().toISOString().split("T")[0];
      if(datePicker.value === today){
        datePicker.classList.add("current");
      } else {
        datePicker.classList.remove("current");
      }
    }

    function loadPractices() {
      db.ref('users/padawe/'+currentDate).once('value', snapshot=>{
        let data = snapshot.val();
        if(!data){
          data=defaultPractices;
          savePractices(data);
        }
        render(data);
        highlightCurrentDate();
      });
    }

    function savePractices(practices){
      db.ref('users/padawe/'+currentDate).set(practices);
    }

    function render(practices){
      listEl.innerHTML="";
      practices.forEach((p,index)=>{
        let li=document.createElement("li");

        let checkbox=document.createElement("input");
        checkbox.type="checkbox";
        checkbox.checked=p.completed;
        checkbox.onchange=e=>{
          e.stopPropagation();
          practices[index].completed=checkbox.checked;
          savePractices(practices);
        };
        li.appendChild(checkbox);
        li.appendChild(document.createTextNode(" "+p.name));

        let editBtn=document.createElement("button");
        editBtn.textContent="E";
        editBtn.className="edit-btn";
        editBtn.onclick=e=>{
          e.stopPropagation();
          const newName=prompt("Edit practice name:",p.name);
          if(newName){
            practices[index].name=newName;
            savePractices(practices);
            render(practices);
          }
        };
        li.appendChild(editBtn);

        let deleteBtn=document.createElement("button");
        deleteBtn.textContent="D";
        deleteBtn.className="delete-btn";
        deleteBtn.onclick=e=>{
          e.stopPropagation();
          practices.splice(index,1);
          savePractices(practices);
          render(practices);
        };
        li.appendChild(deleteBtn);

        li.onclick=()=>{
          checkbox.checked=!checkbox.checked;
          practices[index].completed=checkbox.checked;
          savePractices(practices);
        };

        listEl.appendChild(li);
      });
    }

    document.getElementById("prev-day").onclick=()=>{
      currentDate=new Date(new Date(currentDate).getTime()-86400000).toISOString().split("T")[0];
      datePicker.value=currentDate;
      loadPractices();
    };
    document.getElementById("next-day").onclick=()=>{
      currentDate=new Date(new Date(currentDate).getTime()+86400000).toISOString().split("T")[0];
      datePicker.value=currentDate;
      loadPractices();
    };
    datePicker.onchange=()=>{
      currentDate=datePicker.value;
      loadPractices();
    };
    document.getElementById("mode-btn").onclick=()=>{bodyEl.classList.toggle("dark");};
    document.getElementById("add-btn").onclick=()=>{
      const name=prompt("Enter new practice name:");
      if(!name) return;
      db.ref('users/padawe/'+currentDate).once('value',snapshot=>{
        let practices=snapshot.val()||[];
        const newId=practices.length?Math.max(...practices.map(p=>p.id))+1:1;
        practices.push({id:newId,name,completed:false});
        savePractices(practices);
        render(practices);
      });
    };

    loadPractices();
  </script>
</body>
</html>
